<!--\n  Spreadsheet Explorer\n  --------------------\n  HOW TO USE\n  1. Save this file as index.html (or any name you like) in an empty folder.\n  2. Make sure your Google Sheet is shared with \"Anyone with the link can view\".\n  3. Commit the folder to a GitHub repository and enable **GitHub Pages** *or* drag‑and‑drop the folder onto Netlify / Vercel for instant hosting.\n  4. Open the resulting URL – the table below will automatically pull data from the sheet and let visitors filter each column individually.\n  5. To hook up a different sheet or tab, just edit `SHEET_ID` and `TAB_NAME` in the CONFIGURATION section below.\n\n  No backend, authentication or API keys required – the public Sheet is fetched as JSON via the free **opensheet** service.\n-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spreadsheet Explorer</title>

  <!-- DataTables & jQuery CDNs -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.11/css/jquery.dataTables.min.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.11/js/jquery.dataTables.min.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      margin: 2rem;
    }
    table.dataTable thead th {
      position: sticky;
      top: 0;
      background: #f9fafb;
    }
    h1 {
      font-size: 1.75rem;
      margin-bottom: 1rem;
    }
    p {
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <h1>Spreadsheet Explorer</h1>
  <p>Use the dropdowns in each column header to filter the data. Hold <kbd>Ctrl</kbd> / <kbd>Cmd</kbd> to select multiple values at once.</p>

  <table id="sheetTable" class="display" style="width:100%">
    <thead id="tableHead"></thead>
    <tbody></tbody>
  </table>

  <script>
    // === CONFIGURATION ===
    const SHEET_ID = "1bvwOIe08wLicl7LuPrx9c7Dx1z8brltg";
    // Use the sheet tab name (case‑sensitive) or tab index. "1" grabs the first tab.
    const TAB_NAME = "1";
    const ENDPOINT = `https://opensheet.elk.sh/${SHEET_ID}/${TAB_NAME}`;

    // === FETCH DATA FROM SHEET ===
    fetch(ENDPOINT)
      .then((res) => res.json())
      .then((json) => buildTable(json))
      .catch((err) => console.error("Failed to load sheet:", err));

    function buildTable(data) {
      if (!data.length) {
        console.warn("Sheet contains no rows");
        return;
      }

      // Build column definitions from keys in the first row
      const keys = Object.keys(data[0]);
      const columns = keys.map((k) => ({ title: k, data: k }));

      // Inject <th> cells into thead
      const thead = document.getElementById("tableHead");
      const headerRow = document.createElement("tr");
      keys.forEach((k) => {
        const th = document.createElement("th");
        th.textContent = k;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      // Initialise DataTable
      const table = $("#sheetTable").DataTable({
        data,
        columns,
        pageLength: 25,
        initComplete: function () {
          // Build a <select> for every column header
          this.api()
            .columns()
            .every(function () {
              const column = this;
              const select =
                $("<select aria-label='Filter column'><option value=""></option></select>")
                  .appendTo($(column.header()).empty())
                  .on("change", function () {
                    const val = $.fn.dataTable.util.escapeRegex($(this).val());
                    column.search(val ? "^" + val + "$" : "", true, false).draw();
                  });

              // Get unique values, sort and add to <select>
              column
                .data()
                .unique()
                .sort()
                .each(function (d) {
                  if (d !== null && d !== undefined && d !== "") {
                    select.append(`<option value="${d}">${d}</option>`);
                  }
                });
            });
        },
      });
    }
  </script>
</body>
</html>
